#! /bin/sh

. ~/.jab/environ

export PROMPT_COLOUR=none
if [ "$1" == "green" ]
then
	export PROMPT_COLOUR="$PROMPT_LIGHT_GREEN"
	export PROMPT_OPPOSITE_COLOUR="$PROMPT_MAGENTA"
elif [ "$1" == "red" ]
then
	export PROMPT_COLOUR="$PROMPT_LIGHT_RED"
	export PROMPT_OPPOSITE_COLOUR="$PROMPT_CYAN"
elif [ "$1" == "blue" ]
then
	export PROMPT_COLOUR="$PROMPT_LIGHT_BLUE"
	export PROMPT_OPPOSITE_COLOUR="$PROMPT_YELLOW"
else
	export PROMPT_COLOUR=none
fi

prompt_command ()
{
	if [ -z "$1" ]
	then
		how_do_you_do_nothing_in_a_bash_script=0
	elif [[ $1 == 0 ]]
	then
		export STATUS="${PROMPT_GREEN}$1${PROMPT_NO_COLOUR}"
	else
		export STATUS="${PROMPT_RED}$1${PROMPT_NO_COLOUR}"
	fi
	echo
	echo -ne $STATUS
	if svn stat -q | wc -l | grep -q 0
	then Dir="\$PWD"
	else Dir="${PROMPT_OPPOSITE_COLOUR}\${PWD}${PROMPT_COLOUR}"
	fi
	export PS1=" ${PROMPT_COLOUR}[\D{%A %Y-%m-%d.%T} \u@\h:$Dir]${PROMPT_NO_COLOUR}\n$ "
	j --add "$(pwd -P)"
}

if [[ "$PROMPT_COLOUR" == "none" ]]
then
	export PROMPT_COMMAND=
	export PS1="\$? [\u@\h:\$PWD]\n$ "
else
	export PROMPT_COMMAND='prompt_command $?'
fi

bind '"\e[A"':history-search-backward
bind '"\e[B"':history-search-forward

